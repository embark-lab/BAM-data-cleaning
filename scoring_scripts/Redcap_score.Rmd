# 0. Load packages
```{r, message=FALSE}
library(readxl)
library(haven)
library(cgwtools)
library(scorekeeper)
library(purrr)
library(tibble)
library(dplyr)
```


# 1. Download Data from API

# 2. Scorekeep 

```{r, warning=FALSE}

# Load Raw data; name cleaned data file for output
load('data/BAM_RA_raw.Rdata')  ## CHANGE THIS FOR NEW STUDIES

# Load Individual Scoresheets
filenames <- list.files('scoresheets_clean/') # MAKE SURE THIS IS THE CORRECT DIRECTORY NAME
filenames <- paste('scoresheets_clean', filenames, sep = '/' )
ldf <- lapply(filenames, read_xlsx)

# List of Measure Names from the Scoresheets
measures <- list.files('scoresheets_clean/') 
measures <- gsub('.xlsx*', '', measures)

# Names the scoresheets
names(ldf) <- measures

# Cleans and saves cleaned data for each measure 

x <- vector(mode = 'list', length = (length(measures)))
names(x) <- measures

tibble_func_1 <- function(x) {
  y = as_tibble(x)
  return (y) }

cleaned_data <- purrr::map(x, tibble_func_1)

for (i in 1:length(measures)) {
cleaned <- scorekeep(BAM_RA_raw, ldf[[i]])
cleaned_last <- cleaned[[max(ldf[[i]]$step)]]
cleaned_data[[i]] <-cleaned_last
}
```

# 3. Post-Scorekeep Data Processing

## 3.1. Weight Suppression Variables

## 3.2. TMFS zero center

# 4. Long Dataset

# 5. Wide Dataset

# 6. Save cleaned data 
```{r}
# Dataset with dataframes separated by measure
BAM_Redcap <- cleaned_data 
save(BAM_Redcap, file = 'data/BAM_Redcap.RData') 

# Long Dataframe

# Wide Dataframe
```

# 7. Clear environment and load data for checking
```{r}
rm(list = ls())
load('data/BAM_Redcap.RData')
```

